{% layout "layout.liquid" %} {% block content %}
    <div>
        
        <a href="/books/" type="button" class="btn btn-primary">Back to Main</a>
        
        <article>
            <h2>{{ book.title }}</h2>
           
            <h3>{{ book.author }}</h3>
            <h3>{{ book.series }}</h3>
            
            
            <form action="/users/show" method="post">
                {% comment %} <legend>New User</legend>
                <label>USERNAME: <input type="text" name="username" required /> </label> {% endcomment %}
                <label>
                    Read:<input type="checkbox" name="hasRead" {% if
                        book.hadRead == true %} checked {% endif %} />
                    </label><br>
                    {% comment %} <a href="/reviews/new" type="button" class="btn btn-outline-primary">Add a Review</a> {% endcomment %}
                    <a href="/reviews/{{ book.id }}/new" type="button" class="btn btn-outline-primary">Add a Review</a>
                    {% comment %} <input type="submit" value="Add a Review" href> {% endcomment %}
                    {% comment %} <input type="submit" value="Add to Library" class="btn btn-primary"/> {% endcomment %}
                    {% comment %} {% if book.library == true %} submit {% endif %} {% endcomment %}
                    {% comment %} <fieldset>
                </fieldset> {% endcomment %}
            
            
            {% comment %} DO I WANT THIS ON USER PROFILE OR PAGE? {% endcomment %}
            {% comment %}{{ book.title }} -
             {% if hasRead == true %}
            Already read this book
            {% else %}
            Have not read yet
            {% endif %} {% endcomment %}
            {% comment %} <h3>{{ book.review }}</h3> {% endcomment %}


            {% comment %} <a href="/books/{{ book._id }}/edit"><button>Edit</button></a> {% endcomment %}
            <br><br>
               
            <h2>Reviews</h2>
            <form id="add-review-form" method="POST" action="/books/{{book._id}}/reviews"> 
              <!-- // added this action above to be able to pull the movie id to display it's specific reviews  -->
              <label>Review:</label>
              <textarea name="content"></textarea>
              <label>Rating:</label>
              <select name="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <input type="submit" value="Add Review">
            </form>
            
            <% if (movie.reviews.length) { %>
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Review</th>
                    <th>Rating</th>
                  </tr>
                </thead>
                <tbody>
                  <% let total = 0 %>
                  <% movie.reviews.forEach(function(r) { %>
                    <% total += r.rating %>
                    <tr>
                      <td><%= r.createdAt.toLocaleDateString() %></td>
                      <td><%= r.content %></td>
                      <td><%= r.rating %></td>
                    </tr>
                  <% }); %>
                  <tr>
                    <td colspan="2"></td>
                    <td><strong><%= (total / movie.reviews.length).toFixed(1) %></strong></td>
                  </tr>
                </tbody>
              </table>
            <% } else { %>
              <h5>No Reviews Yet</h5>
            <% } %>


        </article>
    </div>
{% endblock %}
